<!-- templates/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Exam Registration System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Additional quick styles */
        .filter-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .exam-card {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            text-align: center;
            background: white;
        }
        .exam-card.hidden {
            display: none;
        }
    </style>
</head>
<body style="background-image: url('{{ url_for('static', filename='images/background.png') }}'); background-size: cover;">

<div class="container">
    <h1>Welcome, {{ name.capitalize() }}!</h1>

    <h2>Available Exam Sessions</h2>

    <div class="filter-group">
        <select id="examNameFilter">
            <option value="">Filter by Exam Name</option>
            {% for session in available_sessions %}
                <option value="{{ session.exam_name }}">{{ session.exam_name }}</option>
            {% endfor %}
        </select>

        <select id="campusFilter">
            <option value="">Filter by Campus</option>
            <option value="Charleston Campus">Charleston Campus</option>
            <option value="North Las Vegas Campus">North Las Vegas Campus</option>
            <option value="Henderson Campus">Henderson Campus</option>
        </select>

        <input type="date" id="dateFilter">

        <select id="timeFilter">
            <option value="">Filter by Time</option>
            <option value="morning">Morning (08:00 - 11:59)</option>
            <option value="afternoon">Afternoon (12:00 - 15:59)</option>
            <option value="evening">Evening (16:00 - 17:00)</option>
        </select>
    </div>

    <div id="examSessions">
        {% if available_sessions %}
            {% for session in available_sessions %}
                <div class="exam-card" 
                     data-exam="{{ session.exam_name }}" 
                     data-campus="{{ session.campus }}" 
                     data-date="{{ session.date }}" 
                     data-time="{{ session.time }}">
                    <h3>{{ session.exam_name }}</h3>
                    <p><strong>Campus:</strong> {{ session.campus }}</p>
                    <p><strong>Date:</strong> {{ session.date }}</p>
                    <p><strong>Time:</strong> {{ session.time }}</p>
                    <p><strong>Proctor:</strong> {{ session.proctor }}</p>
                    <p><strong>Seats Left:</strong> {{ session.seats }}</p>

                    <form method="POST" action="/register_exam">
                        <input type="hidden" name="session_id" value="{{ session.session_id }}">
                        <button type="submit" class="btn">Register</button>
                    </form>
                </div>
            {% endfor %}
        {% else %}
            <p>No available sessions at the moment.</p>
        {% endif %}
    </div>
</div>

<script>
    const examNameFilter = document.getElementById('examNameFilter');
    const campusFilter = document.getElementById('campusFilter');
    const dateFilter = document.getElementById('dateFilter');
    const timeFilter = document.getElementById('timeFilter');
    const cards = document.querySelectorAll('.exam-card');

    function filterCards() {
        const selectedExam = examNameFilter.value.toLowerCase();
        const selectedCampus = campusFilter.value.toLowerCase();
        const selectedDate = dateFilter.value;
        const selectedTime = timeFilter.value;

        cards.forEach(card => {
            const exam = card.getAttribute('data-exam').toLowerCase();
            const campus = card.getAttribute('data-campus').toLowerCase();
            const date = card.getAttribute('data-date');
            const time = card.getAttribute('data-time');

            let visible = true;

            if (selectedExam && !exam.includes(selectedExam)) {
                visible = false;
            }

            if (selectedCampus && !campus.includes(selectedCampus)) {
                visible = false;
            }

            if (selectedDate && selectedDate !== formatDate(date)) {
                visible = false;
            }

            if (selectedTime) {
                const sessionHour = parseInt(time.split(':')[0]);
                if (selectedTime === 'morning' && !(8 <= sessionHour && sessionHour <= 11)) visible = false;
                if (selectedTime === 'afternoon' && !(12 <= sessionHour && sessionHour <= 15)) visible = false;
                if (selectedTime === 'evening' && !(16 <= sessionHour && sessionHour <= 17)) visible = false;
            }

            if (visible) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    }

    function formatDate(inputDate) {
        const date = new Date(inputDate);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    examNameFilter.addEventListener('change', filterCards);
    campusFilter.addEventListener('change', filterCards);
    dateFilter.addEventListener('change', filterCards);
    timeFilter.addEventListener('change', filterCards);
</script>

</body>
</html>
